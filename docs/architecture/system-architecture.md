# 母婴商城系统架构

## 架构概述

母婴商城系统采用现代分层架构设计，基于Spring Boot框架构建。整个系统采用前后端分离模式，后端提供RESTful API，前端通过API调用获取数据并展示。系统在设计上充分考虑了高可用性、高性能和可扩展性。

## 系统架构图

![系统架构图](./diagrams/system-architecture.png)

## 系统组件

### 1. 表示层（Presentation Layer）

- **前端应用**：
  - 用户端：基于Vue.js实现的移动端SPA应用
  - 管理端：基于React实现的后台管理系统
  - 小程序：微信小程序端

- **网关层**：
  - API网关：采用Spring Cloud Gateway，负责请求路由、负载均衡、限流、认证授权等
  - 静态资源服务：采用CDN加速静态资源访问

### 2. 应用层（Application Layer）

- **API服务层**：
  - Controller层：处理HTTP请求，参数校验，返回结果
  - 安全过滤器：处理权限验证、请求签名验证等
  - 全局异常处理：统一处理异常并返回标准错误信息
  - API文档：使用SpringDoc自动生成API文档

### 3. 业务层（Business Layer）

- **核心业务服务**：
  - 用户服务：用户注册、登录、信息管理
  - 商品服务：商品管理、分类管理、品牌管理
  - 订单服务：订单创建、订单状态管理、支付集成
  - 购物车服务：购物车管理
  - 搜索服务：基于Elasticsearch的全文搜索
  - 促销服务：优惠券、活动管理
  - 积分服务：积分规则、积分兑换
  - 通知服务：短信、邮件、推送等

- **业务支撑服务**：
  - 状态机引擎：处理订单、支付等状态流转
  - 事件总线：基于Spring Event的事件驱动机制
  - 分布式锁：基于Redis实现的分布式锁服务
  - TCC服务：实现分布式事务

### 4. 持久层（Persistence Layer）

- **数据访问层**：
  - Mapper层：使用MyBatis-Plus访问数据库
  - Repository层：抽象数据访问操作
  - 缓存层：多级缓存设计，Redis缓存热点数据

### 5. 数据存储层（Data Storage Layer）

- **数据存储**：
  - MySQL：主数据库，存储业务核心数据
  - Redis：缓存、分布式锁、Session存储
  - Elasticsearch：全文搜索引擎
  - 文件存储：阿里云OSS，存储图片等静态资源

### 6. 基础设施层（Infrastructure Layer）

- **运维支撑**：
  - Docker：容器化部署
  - Kubernetes：容器编排
  - Jenkins：CI/CD自动化部署
  - ELK：日志收集与分析
  - Prometheus + Grafana：监控与告警

## 系统交互流程

1. 客户端通过HTTPS请求访问系统API
2. 请求首先经过API网关进行路由和负载均衡
3. 请求到达应用服务器，经过安全过滤器进行认证授权
4. Controller层接收请求，进行参数验证后调用Service层
5. Service层实现业务逻辑，调用Repository层访问数据
6. Repository层通过MyBatis-Plus访问MySQL数据库或Redis缓存
7. 返回数据经过Service层处理后由Controller层封装为标准响应
8. 响应通过API网关返回给客户端

## 高可用设计

系统采用以下手段保证高可用：

1. **多节点部署**：所有服务均采用多实例部署
2. **负载均衡**：通过Nginx和Spring Cloud Gateway实现负载均衡
3. **服务熔断与降级**：使用Circuit Breaker模式防止级联故障
4. **数据库高可用**：MySQL主从复制，读写分离
5. **缓存高可用**：Redis集群，多级缓存策略
6. **限流保护**：API网关层实现请求限流

## 扩展性设计

系统考虑了未来的扩展需求：

1. **水平扩展**：所有服务均可通过增加节点实现水平扩展
2. **垂直拆分**：核心业务模块设计为可独立部署的服务
3. **插件化设计**：支付、物流等第三方服务采用插件化设计
4. **配置中心**：关键配置外部化，支持动态调整 