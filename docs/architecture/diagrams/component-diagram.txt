# 母婴商城组件交互图文本描述

## 图表结构描述

本文档描述了母婴商城系统中各组件之间的交互关系，作为实际绘制组件交互图的参考。

## 主要组件

1. **前端应用**
   - 用户移动端
   - 用户网页端
   - 商家后台
   - 管理员后台

2. **API网关**
   - Spring Cloud Gateway
   - 安全过滤器
   - 流量控制

3. **核心控制器**
   - 用户控制器
   - 商品控制器
   - 订单控制器
   - 支付控制器
   - 搜索控制器
   - 购物车控制器

4. **核心服务**
   - 用户服务
   - 认证/授权服务
   - 商品服务
   - 库存服务
   - 订单服务
   - 支付服务
   - 搜索服务
   - 购物车服务
   - 促销服务
   - 积分服务
   - 通知服务

5. **支撑组件**
   - 状态机引擎
   - 事件总线
   - 缓存服务
   - 分布式锁服务
   - TCC事务协调器

6. **数据访问组件**
   - 各服务对应的数据访问对象
   - 缓存适配器

7. **存储组件**
   - MySQL数据库
   - Redis缓存
   - Elasticsearch搜索引擎
   - 对象存储服务

8. **外部系统**
   - 支付宝API
   - 微信支付API
   - 短信服务
   - CDN服务

## 核心交互流程

### 1. 用户认证流程

```
用户前端 → API网关 → 认证控制器 → 认证服务 → 用户服务 → MySQL/Redis
                                          ↓
                                     JWT生成器
                                          ↓
                         响应JWT令牌 ← 认证控制器
```

### 2. 商品浏览流程

```
用户前端 → API网关 → 商品控制器 → 商品服务 → 缓存适配器 → Redis缓存
                                         ↓
                                    MySQL数据库
```

### 3. 商品搜索流程

```
用户前端 → API网关 → 搜索控制器 → 搜索服务 → Elasticsearch
                                      ↓
                                  商品服务
                                      ↓
                                MySQL/Redis
```

### 4. 购物车操作流程

```
用户前端 → API网关 → 购物车控制器 → 购物车服务 → MySQL/Redis
                                        ↓
                                    商品服务
                                        ↓
                                    库存服务
```

### 5. 下单流程

```
用户前端 → API网关 → 订单控制器 → 订单服务 → 商品服务 → 库存服务 → 分布式锁 → MySQL/Redis
                                     ↓
                                 状态机引擎
                                     ↓
                                 事件总线 → 通知服务 → 短信/邮件API
                                     ↓
                                 促销服务
                                     ↓
                                 支付服务
```

### 6. 支付流程

```
用户前端 → API网关 → 支付控制器 → 支付服务 → 支付适配器 → 第三方支付API
                                     ↓
                                 订单服务
                                     ↓
                                状态机引擎
                                     ↓
                                 事件总线 → 通知服务
                                     ↓
                                积分服务 → MySQL
```

### 7. 库存管理流程

```
下单请求 → 订单服务 → 库存服务 → 分布式锁 → MySQL
                           ↓
                      状态机引擎
                           ↓
                       事件总线
```

## 组件交互模式

### 同步调用模式

表示为实线箭头，例如：
- 控制器调用服务
- 服务间的直接依赖调用
- 数据库直接查询

### 异步事件模式

表示为虚线箭头，例如：
- 事件总线发布的事件
- 消息队列传递的消息
- 异步通知

## 关键数据流

1. **用户数据流**：
   - 用户注册/登录 → 用户服务 → MySQL
   - 用户会话 → Redis

2. **商品数据流**：
   - 商品管理 → 商品服务 → MySQL
   - 商品浏览 → 缓存 → Redis
   - 商品搜索 → Elasticsearch

3. **订单数据流**：
   - 订单创建 → 订单服务 → MySQL
   - 订单状态 → 状态机 → 事件总线

4. **支付数据流**：
   - 支付请求 → 支付服务 → 第三方API
   - 支付结果 → webhook回调 → 支付服务

## 绘图建议

- 使用不同形状区分不同类型的组件（服务、数据库、消息等）
- 使用不同颜色区分不同域的组件
- 使用实线和虚线区分同步和异步调用
- 对关键流程使用序号标注调用顺序
- 为重要组件添加简短说明
- 使用分组框将相关组件归类显示 