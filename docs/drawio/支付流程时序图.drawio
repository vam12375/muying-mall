<mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
  <root>
    <mxCell id="0" />
    <mxCell id="1" parent="0" />
    
    <!-- 标题 -->
    <mxCell id="title" value="支付流程时序图 (Payment Sequence Diagram)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
      <mxGeometry x="500" y="20" width="450" height="40" as="geometry" />
    </mxCell>
    
    <!-- 参与者 -->
    <!-- 用户 -->
    <mxCell id="actor-user" value="用户&#xa;(Client)" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
      <mxGeometry x="60" y="80" width="40" height="60" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-user" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#6c8ebf;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="80" y="1100" as="sourcePoint" />
        <mxPoint x="80" y="140" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- OrderController -->
    <mxCell id="participant-oc" value="OrderController" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=11;" vertex="1" parent="1">
      <mxGeometry x="160" y="80" width="120" height="40" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-oc" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#82b366;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="220" y="1100" as="sourcePoint" />
        <mxPoint x="220" y="120" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- OrderService -->
    <mxCell id="participant-os" value="OrderService" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=11;" vertex="1" parent="1">
      <mxGeometry x="320" y="80" width="120" height="40" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-os" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#d79b00;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="380" y="1100" as="sourcePoint" />
        <mxPoint x="380" y="120" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- PaymentService -->
    <mxCell id="participant-pay" value="PaymentService" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=11;" vertex="1" parent="1">
      <mxGeometry x="480" y="80" width="120" height="40" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-pay" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#b85450;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="540" y="1100" as="sourcePoint" />
        <mxPoint x="540" y="120" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- AlipayService -->
    <mxCell id="participant-ali" value="AlipayService" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=11;" vertex="1" parent="1">
      <mxGeometry x="640" y="80" width="110" height="40" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-ali" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#6c8ebf;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="695" y="1100" as="sourcePoint" />
        <mxPoint x="695" y="120" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 支付宝 -->
    <mxCell id="participant-alipay" value="支付宝&#xa;(Alipay)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#1890ff;strokeColor=#0050b3;fontStyle=1;fontSize=11;fontColor=#ffffff;" vertex="1" parent="1">
      <mxGeometry x="790" y="80" width="100" height="40" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-alipay" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#1890ff;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="840" y="1100" as="sourcePoint" />
        <mxPoint x="840" y="120" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- AlipayNotifyController -->
    <mxCell id="participant-notify" value="AlipayNotify&#xa;Controller" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=10;" vertex="1" parent="1">
      <mxGeometry x="930" y="80" width="100" height="40" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-notify" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#82b366;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="980" y="1100" as="sourcePoint" />
        <mxPoint x="980" y="120" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- MessageProducer -->
    <mxCell id="participant-mq" value="MessageProducer&#xa;(RabbitMQ)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=10;" vertex="1" parent="1">
      <mxGeometry x="1070" y="80" width="110" height="40" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-mq" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#d6b656;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="1125" y="1100" as="sourcePoint" />
        <mxPoint x="1125" y="120" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- Database -->
    <mxCell id="participant-db" value="Database&#xa;(MySQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;fontSize=10;" vertex="1" parent="1">
      <mxGeometry x="1220" y="70" width="80" height="55" as="geometry" />
    </mxCell>
    <mxCell id="lifeline-db" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;strokeColor=#666666;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="1260" y="1100" as="sourcePoint" />
        <mxPoint x="1260" y="125" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- ===== 第一部分: 发起支付 ===== -->
    <mxCell id="section1" value="1. 用户发起支付" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;fontStyle=1;" vertex="1" parent="1">
      <mxGeometry x="40" y="160" width="120" height="30" as="geometry" />
    </mxCell>
    
    <!-- 激活条 -->
    <mxCell id="act-oc-1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
      <mxGeometry x="215" y="200" width="10" height="280" as="geometry" />
    </mxCell>
    
    <mxCell id="act-os-1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
      <mxGeometry x="375" y="230" width="10" height="220" as="geometry" />
    </mxCell>
    
    <mxCell id="act-pay-1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
      <mxGeometry x="535" y="260" width="10" height="160" as="geometry" />
    </mxCell>
    
    <mxCell id="act-ali-1" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
      <mxGeometry x="690" y="290" width="10" height="100" as="geometry" />
    </mxCell>
    
    <!-- 消息 1: 用户点击支付 -->
    <mxCell id="msg1" value="1. payOrder(orderId, paymentMethod='alipay')" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="80" y="200" as="sourcePoint" />
        <mxPoint x="215" y="200" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 2: Controller调用Service -->
    <mxCell id="msg2" value="2. payOrder(orderId, userId, method)" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="225" y="230" as="sourcePoint" />
        <mxPoint x="375" y="230" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 3: 获取支付记录 -->
    <mxCell id="msg3" value="3. getPaymentByOrderId(orderId)" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="385" y="260" as="sourcePoint" />
        <mxPoint x="535" y="260" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 3.1: 查询数据库 -->
    <mxCell id="msg3-1" value="SELECT * FROM payment WHERE order_id=?" style="endArrow=block;html=1;strokeWidth=1;strokeColor=#666666;fillColor=#333333;fontSize=9;dashed=1;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="545" y="280" as="sourcePoint" />
        <mxPoint x="1255" y="280" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回支付记录 -->
    <mxCell id="msg3-ret" value="Payment" style="endArrow=open;html=1;strokeWidth=1;strokeColor=#666666;dashed=1;fontSize=9;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="1255" y="295" as="sourcePoint" />
        <mxPoint x="545" y="295" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 4: 生成支付链接 -->
    <mxCell id="msg4" value="4. generatePaymentUrl(payment)" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="545" y="320" as="sourcePoint" />
        <mxPoint x="690" y="320" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 5: 调用支付宝SDK -->
    <mxCell id="msg5" value="5. AlipayClient.pageExecute()" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="700" y="350" as="sourcePoint" />
        <mxPoint x="835" y="350" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回支付表单 -->
    <mxCell id="msg5-ret" value="paymentForm (HTML)" style="endArrow=open;html=1;strokeWidth=2;strokeColor=#333333;dashed=1;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="835" y="375" as="sourcePoint" />
        <mxPoint x="700" y="375" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回支付URL -->
    <mxCell id="msg4-ret" value="paymentUrl" style="endArrow=open;html=1;strokeWidth=2;strokeColor=#333333;dashed=1;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="690" y="400" as="sourcePoint" />
        <mxPoint x="545" y="400" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 更新支付状态为处理中 -->
    <mxCell id="msg6" value="6. UPDATE payment SET status=PROCESSING" style="endArrow=block;html=1;strokeWidth=1;strokeColor=#666666;fillColor=#333333;fontSize=9;dashed=1;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="545" y="420" as="sourcePoint" />
        <mxPoint x="1255" y="420" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回支付信息 -->
    <mxCell id="msg-ret1" value="PaymentInfo{paymentUrl, paymentNo}" style="endArrow=open;html=1;strokeWidth=2;strokeColor=#333333;dashed=1;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="375" y="450" as="sourcePoint" />
        <mxPoint x="225" y="450" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回给用户 -->
    <mxCell id="msg-user-ret1" value="跳转到支付宝支付页面" style="endArrow=open;html=1;strokeWidth=2;strokeColor=#333333;dashed=1;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="215" y="480" as="sourcePoint" />
        <mxPoint x="80" y="480" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- ===== 第二部分: 用户在支付宝完成支付 ===== -->
    <mxCell id="section2" value="2. 用户在支付宝完成支付" style="text;html=1;strokeColor=#1890ff;fillColor=#e6f7ff;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;fontStyle=1;" vertex="1" parent="1">
      <mxGeometry x="40" y="520" width="160" height="30" as="geometry" />
    </mxCell>
    
    <!-- 用户支付 -->
    <mxCell id="msg-pay" value="用户输入密码完成支付" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#1890ff;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="80" y="560" as="sourcePoint" />
        <mxPoint x="835" y="560" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- ===== 第三部分: 支付宝异步回调 ===== -->
    <mxCell id="section3" value="3. 支付宝异步通知" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=12;fontStyle=1;" vertex="1" parent="1">
      <mxGeometry x="40" y="600" width="140" height="30" as="geometry" />
    </mxCell>
    
    <!-- 激活条 - 回调处理 -->
    <mxCell id="act-notify" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
      <mxGeometry x="975" y="650" width="10" height="380" as="geometry" />
    </mxCell>
    
    <mxCell id="act-ali-2" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
      <mxGeometry x="690" y="680" width="10" height="80" as="geometry" />
    </mxCell>
    
    <mxCell id="act-pay-2" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
      <mxGeometry x="535" y="780" width="10" height="120" as="geometry" />
    </mxCell>
    
    <mxCell id="act-os-2" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
      <mxGeometry x="375" y="920" width="10" height="80" as="geometry" />
    </mxCell>
    
    <mxCell id="act-mq" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
      <mxGeometry x="1120" y="1000" width="10" height="30" as="geometry" />
    </mxCell>
    
    <!-- 消息 7: 支付宝发送回调 -->
    <mxCell id="msg7" value="7. POST /api/alipay/notify (异步通知)" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#1890ff;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="840" y="650" as="sourcePoint" />
        <mxPoint x="975" y="650" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 8: 验证签名 -->
    <mxCell id="msg8" value="8. verifySignature(params)" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="985" y="680" as="sourcePoint" />
        <mxPoint x="690" y="680" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 8.1: 使用支付宝公钥验证 -->
    <mxCell id="msg8-1" value="8.1 AlipaySignature.rsaCheckV1()" style="endArrow=block;html=1;strokeWidth=1;strokeColor=#666666;fillColor=#333333;fontSize=9;dashed=1;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="700" y="710" as="sourcePoint" />
        <mxPoint x="835" y="710" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回验证结果 -->
    <mxCell id="msg8-ret" value="verified=true" style="endArrow=open;html=1;strokeWidth=2;strokeColor=#333333;dashed=1;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="690" y="750" as="sourcePoint" />
        <mxPoint x="985" y="750" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 9: 更新支付状态 -->
    <mxCell id="msg9" value="9. updatePaymentStatus(paymentNo, SUCCESS)" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="975" y="790" as="sourcePoint" />
        <mxPoint x="545" y="790" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 9.1: 更新数据库 -->
    <mxCell id="msg9-1" value="UPDATE payment SET status=SUCCESS, transaction_id=?" style="endArrow=block;html=1;strokeWidth=1;strokeColor=#666666;fillColor=#333333;fontSize=9;dashed=1;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="545" y="820" as="sourcePoint" />
        <mxPoint x="1255" y="820" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 9.2: 记录支付日志 -->
    <mxCell id="msg9-2" value="INSERT INTO payment_state_log" style="endArrow=block;html=1;strokeWidth=1;strokeColor=#666666;fillColor=#333333;fontSize=9;dashed=1;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="545" y="850" as="sourcePoint" />
        <mxPoint x="1255" y="850" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回成功 -->
    <mxCell id="msg9-ret" value="success" style="endArrow=open;html=1;strokeWidth=2;strokeColor=#333333;dashed=1;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="535" y="890" as="sourcePoint" />
        <mxPoint x="985" y="890" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 10: 更新订单状态 -->
    <mxCell id="msg10" value="10. updateOrderStatus(orderNo, PENDING_SHIPMENT)" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="975" y="930" as="sourcePoint" />
        <mxPoint x="385" y="930" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 10.1: 更新订单 -->
    <mxCell id="msg10-1" value="UPDATE orders SET status='pending_shipment', pay_time=NOW()" style="endArrow=block;html=1;strokeWidth=1;strokeColor=#666666;fillColor=#333333;fontSize=9;dashed=1;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="385" y="955" as="sourcePoint" />
        <mxPoint x="1255" y="955" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回成功 -->
    <mxCell id="msg10-ret" value="success" style="endArrow=open;html=1;strokeWidth=2;strokeColor=#333333;dashed=1;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="375" y="980" as="sourcePoint" />
        <mxPoint x="985" y="980" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 消息 11: 发送消息 -->
    <mxCell id="msg11" value="11. sendPaymentMessage(PAYMENT_SUCCESS)" style="endArrow=block;html=1;strokeWidth=2;strokeColor=#333333;fillColor=#333333;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="985" y="1010" as="sourcePoint" />
        <mxPoint x="1120" y="1010" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 返回给支付宝 -->
    <mxCell id="msg-final" value="&quot;success&quot;" style="endArrow=open;html=1;strokeWidth=2;strokeColor=#1890ff;dashed=1;fontSize=10;" edge="1" parent="1">
      <mxGeometry width="50" height="50" relative="1" as="geometry">
        <mxPoint x="975" y="1050" as="sourcePoint" />
        <mxPoint x="840" y="1050" as="targetPoint" />
      </mxGeometry>
    </mxCell>
    
    <!-- 注释框 -->
    <mxCell id="note1" value="支付方式支持:&#xa;- alipay (支付宝)&#xa;- wechat (微信)&#xa;- wallet (钱包余额)" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;align=left;verticalAlign=top;spacingLeft=5;spacingTop=5;" vertex="1" parent="1">
      <mxGeometry x="1330" y="200" width="130" height="80" as="geometry" />
    </mxCell>
    
    <mxCell id="note2" value="支付宝异步通知&#xa;需要验证签名&#xa;防止伪造请求" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=9;align=left;verticalAlign=top;spacingLeft=5;spacingTop=5;" vertex="1" parent="1">
      <mxGeometry x="1330" y="680" width="130" height="60" as="geometry" />
    </mxCell>
    
    <mxCell id="note3" value="事务保证:&#xa;支付状态和订单状态&#xa;原子性更新" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=9;align=left;verticalAlign=top;spacingLeft=5;spacingTop=5;" vertex="1" parent="1">
      <mxGeometry x="1330" y="840" width="130" height="60" as="geometry" />
    </mxCell>
    
    <mxCell id="note4" value="RabbitMQ发送&#xa;支付成功消息&#xa;触发后续业务" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;align=left;verticalAlign=top;spacingLeft=5;spacingTop=5;" vertex="1" parent="1">
      <mxGeometry x="1330" y="990" width="130" height="60" as="geometry" />
    </mxCell>
    
  </root>
</mxGraphModel>