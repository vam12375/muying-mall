# æ¯å©´å•†åŸç³»ç»Ÿé«˜å¹¶å‘æ€§èƒ½æµ‹è¯•æŒ‡å—

## ğŸ“‹ ç›®å½•

- [æµ‹è¯•å·¥å…·å®‰è£…](#æµ‹è¯•å·¥å…·å®‰è£…)
- [æµ‹è¯•åœºæ™¯](#æµ‹è¯•åœºæ™¯)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æµ‹è¯•æŒ‡æ ‡](#æµ‹è¯•æŒ‡æ ‡)
- [ä¼˜åŒ–å»ºè®®](#ä¼˜åŒ–å»ºè®®)

## ğŸ›  æµ‹è¯•å·¥å…·å®‰è£…

### 1. JMeterå®‰è£…

```bash
# Windows
# 1. ä¸‹è½½ https://jmeter.apache.org/download_jmeter.cgi
# 2. è§£å‹åˆ°ä»»æ„ç›®å½•
# 3. è¿è¡Œ bin/jmeter.bat

# å¯åŠ¨JMeter
cd apache-jmeter-5.6.3\bin
jmeter.bat
```

### 2. Gatlingå®‰è£…

```bash
# Windows
# 1. ä¸‹è½½ https://gatling.io/open-source/
# 2. è§£å‹åˆ°ä»»æ„ç›®å½•
# 3. å°†æµ‹è¯•è„šæœ¬æ”¾åˆ° user-files/simulations/

# è¿è¡Œæµ‹è¯•
cd gatling-charts-highcharts-bundle-3.9.5
bin\gatling.bat
```

### 3. Locustå®‰è£…

```bash
# å®‰è£…Python 3.7+
pip install locust

# éªŒè¯å®‰è£…
locust --version
```

### 4. WebSocketæµ‹è¯•å·¥å…·

```bash
# å®‰è£…Node.jsä¾èµ–
cd websocket
npm install ws

# è¿è¡Œæµ‹è¯•
node ws-test.js
```

### 5. æ•°æ®åº“å‹æµ‹å·¥å…·

```bash
# Windowsä¸‹ä½¿ç”¨WSLæˆ–Git Bash
# å®‰è£…sysbench
sudo apt-get install sysbench

# æˆ–ä½¿ç”¨Docker
docker run --rm severalnines/sysbench
```

## ğŸ¯ æµ‹è¯•åœºæ™¯

### åœºæ™¯1: å•†å“ç§’æ€ï¼ˆåº“å­˜æ‰£å‡ï¼‰

**æµ‹è¯•ç›®æ ‡**: éªŒè¯é«˜å¹¶å‘ä¸‹åº“å­˜æ‰£å‡çš„å‡†ç¡®æ€§

**å…³é”®æŒ‡æ ‡**:
- å¹¶å‘ç”¨æˆ·æ•°: 1000-5000
- å“åº”æ—¶é—´: < 500ms (P95)
- æˆåŠŸç‡: > 99%
- åº“å­˜å‡†ç¡®æ€§: 100%

**JMeteræµ‹è¯•**:
```bash
# æ‰“å¼€JMeter GUI
jmeter.bat

# åŠ è½½æµ‹è¯•è®¡åˆ’
# File -> Open -> jmeter-seckill-test.jmx

# é…ç½®å‚æ•°
# - çº¿ç¨‹æ•°: 1000
# - Ramp-upæ—¶é—´: 10ç§’
# - å¾ªç¯æ¬¡æ•°: 1

# è¿è¡Œæµ‹è¯•
# Run -> Start
```

**Locustæµ‹è¯•**:
```bash
cd locust
locust -f locustfile.py --host=http://localhost:8080

# æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8089
# è®¾ç½®ç”¨æˆ·æ•°: 1000
# è®¾ç½®æ¯ç§’å¯åŠ¨ç”¨æˆ·æ•°: 100
# ç‚¹å‡» Start swarming
```

### åœºæ™¯2: è®¢å•åˆ›å»ºæµç¨‹

**æµ‹è¯•ç›®æ ‡**: éªŒè¯å®Œæ•´è®¢å•æµç¨‹çš„æ€§èƒ½

**æµ‹è¯•æ­¥éª¤**:
1. ç”¨æˆ·ç™»å½•
2. æµè§ˆå•†å“
3. åŠ å…¥è´­ç‰©è½¦
4. åˆ›å»ºè®¢å•
5. æ”¯ä»˜è®¢å•

**Gatlingæµ‹è¯•**:
```bash
cd gatling-charts-highcharts-bundle-3.9.5

# å¤åˆ¶æµ‹è¯•è„šæœ¬
copy ..\performance-test\gatling\SeckillSimulation.scala user-files\simulations\

# è¿è¡Œæµ‹è¯•
bin\gatling.bat

# é€‰æ‹© SeckillSimulation
# æŸ¥çœ‹æŠ¥å‘Š: results/
```

### åœºæ™¯3: WebSocketå®æ—¶æ¨é€

**æµ‹è¯•ç›®æ ‡**: éªŒè¯WebSocketå¹¶å‘è¿æ¥å’Œæ¶ˆæ¯æ¨é€èƒ½åŠ›

**æµ‹è¯•æ­¥éª¤**:
```bash
cd websocket
node ws-test.js

# ä¿®æ”¹é…ç½®å‚æ•°
# - concurrentConnections: 100-1000
# - testDuration: 60000 (60ç§’)
```

### åœºæ™¯4: æ•°æ®åº“æ€§èƒ½

**æµ‹è¯•ç›®æ ‡**: éªŒè¯æ•°æ®åº“è¯»å†™æ€§èƒ½

```bash
cd database

# ä¿®æ”¹é…ç½®
# ç¼–è¾‘ mysql-benchmark.sh
# - DB_HOST, DB_USER, DB_PASSWORD

# è¿è¡Œæµ‹è¯•
bash mysql-benchmark.sh

# æŸ¥çœ‹ç»“æœ
cat results/oltp_read_write.txt
```

## ğŸ“Š æµ‹è¯•æŒ‡æ ‡

### 1. å“åº”æ—¶é—´æŒ‡æ ‡

| æŒ‡æ ‡ | ä¼˜ç§€ | è‰¯å¥½ | å¯æ¥å— | éœ€ä¼˜åŒ– |
|------|------|------|--------|--------|
| å¹³å‡å“åº”æ—¶é—´ | < 100ms | < 300ms | < 500ms | > 500ms |
| P95å“åº”æ—¶é—´ | < 200ms | < 500ms | < 1000ms | > 1000ms |
| P99å“åº”æ—¶é—´ | < 500ms | < 1000ms | < 2000ms | > 2000ms |

### 2. ååé‡æŒ‡æ ‡

| åœºæ™¯ | ç›®æ ‡TPS | ä¼˜ç§€ | è‰¯å¥½ |
|------|---------|------|------|
| å•†å“æŸ¥è¯¢ | 5000+ | 10000+ | 5000+ |
| è®¢å•åˆ›å»º | 1000+ | 2000+ | 1000+ |
| åº“å­˜æ‰£å‡ | 500+ | 1000+ | 500+ |

### 3. å¹¶å‘ç”¨æˆ·æ•°

| åœºæ™¯ | ç›®æ ‡å¹¶å‘ | å‹åŠ›æµ‹è¯• |
|------|----------|----------|
| æ­£å¸¸ä¸šåŠ¡ | 1000 | 5000 |
| ç§’æ€æ´»åŠ¨ | 5000 | 10000 |
| å¤§ä¿ƒæ´»åŠ¨ | 10000 | 20000 |

### 4. é”™è¯¯ç‡

- ç›®æ ‡: < 0.1%
- å¯æ¥å—: < 1%
- éœ€ä¼˜åŒ–: > 1%

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ¡ˆ1: ä½¿ç”¨Locustï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# 1. å®‰è£…
pip install locust

# 2. è¿è¡Œ
cd performance-test/locust
locust -f locustfile.py --host=http://localhost:8080

# 3. æ‰“å¼€æµè§ˆå™¨
# http://localhost:8089

# 4. é…ç½®æµ‹è¯•
# - Number of users: 100
# - Spawn rate: 10
# - Host: http://localhost:8080

# 5. å¼€å§‹æµ‹è¯•
# ç‚¹å‡» "Start swarming"

# 6. æŸ¥çœ‹å®æ—¶æŠ¥å‘Š
# åœ¨Webç•Œé¢æŸ¥çœ‹TPSã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡ç­‰
```

### æ–¹æ¡ˆ2: ä½¿ç”¨JMeterï¼ˆæ¨èä¸“ä¸šæµ‹è¯•ï¼‰

```bash
# 1. å¯åŠ¨JMeter
jmeter.bat

# 2. åˆ›å»ºæµ‹è¯•è®¡åˆ’
# - æ·»åŠ çº¿ç¨‹ç»„
# - æ·»åŠ HTTPè¯·æ±‚
# - æ·»åŠ ç›‘å¬å™¨ï¼ˆæŸ¥çœ‹ç»“æœæ ‘ã€èšåˆæŠ¥å‘Šï¼‰

# 3. é…ç½®å‚æ•°
# - çº¿ç¨‹æ•°: 1000
# - Ramp-up: 10
# - å¾ªç¯: 1

# 4. è¿è¡Œæµ‹è¯•
# Run -> Start

# 5. æŸ¥çœ‹æŠ¥å‘Š
# èšåˆæŠ¥å‘Šã€å›¾å½¢ç»“æœ
```

### æ–¹æ¡ˆ3: ä½¿ç”¨Gatlingï¼ˆæ¨èCI/CDï¼‰

```bash
# 1. ç¼–å†™æµ‹è¯•è„šæœ¬ï¼ˆå·²æä¾›ï¼‰
# performance-test/gatling/SeckillSimulation.scala

# 2. è¿è¡Œæµ‹è¯•
cd gatling-charts-highcharts-bundle-3.9.5
bin\gatling.bat

# 3. é€‰æ‹©æµ‹è¯•åœºæ™¯
# è¾“å…¥æ•°å­—é€‰æ‹© SeckillSimulation

# 4. æŸ¥çœ‹HTMLæŠ¥å‘Š
# results/seckillsimulation-xxx/index.html
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Šç¤ºä¾‹

### LocustæŠ¥å‘Š

```
Type     Name                      # reqs      # fails  |    Avg     Min     Max  Median  |   req/s failures/s
--------|-------------------------|-----------|---------|-------|-------|-------|-------|--------|----------
POST     /api/order/create         10000          50   |    245      12    1234     180  |   166.7      0.83
GET      /api/products              5000           0   |     45       8     234      38  |    83.3      0.00
--------|-------------------------|-----------|---------|-------|-------|-------|-------|--------|----------
         Aggregated                15000          50   |    178      8     1234     120  |   250.0      0.83

Response time percentiles (approximated)
Type     Name                                  50%    66%    75%    80%    90%    95%    98%    99%  99.9% 99.99%   100%
--------|-------------------------------------|--------|------|------|------|------|------|------|------|------|------|------|
POST     /api/order/create                     180    220    280    320    450    580    780    920   1200   1230   1234
GET      /api/products                          38     45     52     58     78     98    145    189    230    234    234
--------|-------------------------------------|--------|------|------|------|------|------|------|------|------|------|------|
         Aggregated                            120    165    210    250    380    500    720    880   1190   1230   1234
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. åº”ç”¨å±‚ä¼˜åŒ–

```java
// ä½¿ç”¨Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
@Cacheable(value = "products", key = "#productId")
public Product getProductById(Long productId) {
    return productMapper.selectById(productId);
}

// ä½¿ç”¨åˆ†å¸ƒå¼é”é˜²æ­¢è¶…å–
@RedisLock(key = "stock:#{#skuId}", waitTime = 3, leaseTime = 10)
public boolean deductStock(Long skuId, Integer quantity) {
    // åº“å­˜æ‰£å‡é€»è¾‘
}

// å¼‚æ­¥å¤„ç†éæ ¸å¿ƒä¸šåŠ¡
@Async
public void sendOrderNotification(Order order) {
    // å‘é€è®¢å•é€šçŸ¥
}
```

### 2. æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_product_status ON product(status, create_time);
CREATE INDEX idx_order_user_status ON `order`(user_id, status);

-- åˆ†è¡¨ç­–ç•¥
-- è®¢å•è¡¨æŒ‰æœˆåˆ†è¡¨
CREATE TABLE order_202501 LIKE `order`;
CREATE TABLE order_202502 LIKE `order`;

-- è¯»å†™åˆ†ç¦»
-- ä¸»åº“ï¼šå†™æ“ä½œ
-- ä»åº“ï¼šè¯»æ“ä½œ
```

### 3. ç¼“å­˜ç­–ç•¥

```yaml
# Redisé…ç½®
spring:
  redis:
    host: localhost
    port: 6379
    lettuce:
      pool:
        max-active: 200
        max-idle: 50
        min-idle: 10
```

### 4. è¿æ¥æ± ä¼˜åŒ–

```yaml
# æ•°æ®åº“è¿æ¥æ± 
spring:
  datasource:
    hikari:
      maximum-pool-size: 50
      minimum-idle: 10
      connection-timeout: 30000
```

### 5. JVMå‚æ•°ä¼˜åŒ–

```bash
# å¯åŠ¨å‚æ•°
java -Xms2g -Xmx2g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=200 \
     -XX:+HeapDumpOnOutOfMemoryError \
     -jar muying-mall.jar
```

## ğŸ“ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] å‡†å¤‡æµ‹è¯•ç¯å¢ƒï¼ˆç‹¬ç«‹æµ‹è¯•æœåŠ¡å™¨ï¼‰
- [ ] å‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆç”¨æˆ·ã€å•†å“ã€åº“å­˜ï¼‰
- [ ] é…ç½®ç›‘æ§å·¥å…·ï¼ˆPrometheusã€Grafanaï¼‰
- [ ] æ‰§è¡ŒåŸºå‡†æµ‹è¯•ï¼ˆå•æ¥å£æ€§èƒ½ï¼‰
- [ ] æ‰§è¡Œå‹åŠ›æµ‹è¯•ï¼ˆé€æ­¥å¢åŠ è´Ÿè½½ï¼‰
- [ ] æ‰§è¡Œç¨³å®šæ€§æµ‹è¯•ï¼ˆé•¿æ—¶é—´è¿è¡Œï¼‰
- [ ] åˆ†ææµ‹è¯•ç»“æœ
- [ ] å®šä½æ€§èƒ½ç“¶é¢ˆ
- [ ] å®æ–½ä¼˜åŒ–æ–¹æ¡ˆ
- [ ] å›å½’æµ‹è¯•éªŒè¯

## ğŸ“ æœ€ä½³å®è·µ

1. **é€æ­¥åŠ å‹**: ä»å°å¹¶å‘å¼€å§‹ï¼Œé€æ­¥å¢åŠ 
2. **ç›‘æ§æŒ‡æ ‡**: åŒæ—¶ç›‘æ§CPUã€å†…å­˜ã€ç½‘ç»œã€æ•°æ®åº“
3. **éš”ç¦»ç¯å¢ƒ**: ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•ç¯å¢ƒ
4. **çœŸå®æ•°æ®**: ä½¿ç”¨æ¥è¿‘ç”Ÿäº§çš„æ•°æ®é‡
5. **å¤šæ¬¡æµ‹è¯•**: æ¯ä¸ªåœºæ™¯è‡³å°‘æµ‹è¯•3æ¬¡å–å¹³å‡å€¼
6. **è®°å½•ç»“æœ**: è¯¦ç»†è®°å½•æ¯æ¬¡æµ‹è¯•çš„é…ç½®å’Œç»“æœ

## ğŸ“ é—®é¢˜æ’æŸ¥

### å“åº”æ—¶é—´è¿‡é•¿
- æ£€æŸ¥æ•°æ®åº“æ…¢æŸ¥è¯¢
- æ£€æŸ¥æ˜¯å¦æœ‰N+1æŸ¥è¯¢
- æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
- æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ

### é”™è¯¯ç‡è¿‡é«˜
- æ£€æŸ¥åº”ç”¨æ—¥å¿—
- æ£€æŸ¥æ•°æ®åº“è¿æ¥æ± 
- æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
- æ£€æŸ¥çº¿ç¨‹æ± é…ç½®

### ååé‡ä¸è¶³
- å¢åŠ åº”ç”¨å®ä¾‹ï¼ˆæ°´å¹³æ‰©å±•ï¼‰
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- å¢åŠ ç¼“å­˜ä½¿ç”¨
- ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°

---

**ç»´æŠ¤è€…**: é’æŸ æª¬  
**æœ€åæ›´æ–°**: 2025-12-04
